<!DOCTYPE html>
<html lang="en">

<head>
        <script>
            try {
                var theme = localStorage.getItem('theme');
                if (theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                }
            } catch(e){}
        </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv=X-UA-Compatible content="IE=11">
    <link rel="shortcut icon" type="image/png" href="../public/images/favicon.ico">
    <title>All QuantumPhunks - CryptoPhunksV67</title>
    <meta name="description" content="View all QuantumPhunks in the collection" />
    <link rel="stylesheet" href="../public/components/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../public/components/bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
    <link rel="stylesheet" href="../public/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../public/stylesheets/mainf500.css?v=13" charset="utf-8" >
    <link rel="stylesheet" type="text/css" href="../public/stylesheets/stylesf500.css?v=13" charset="utf-8" >

    <meta property="og:title" content="All QuantumPhunks - CryptoPhunksV67" />
    <meta property="og:description" content="View all QuantumPhunks in the collection" />

    <script src="../public/components/jquery-3.7.1.min.js"></script>
    <script src="../public/components/bootstrap/js/bootstrap.min.js"></script>
</head>
<body>

<header class="container main_header">
    <div class="row">
        <div class="col-lg-3 col-xs-2">
            <a href="../index.html" class="logo ">
            <svg viewBox="0 0 16 26" y="0" x="0"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-logo"></use></svg>
            <span class="hidden-xs hidden-sm">DystoLabz</span>
            </a>
        </div>
        <div class="col-lg-9 col-xs-10">
            <nav class="main_navigation">
                <ul class="list main_nav_list">
                    <li class="jsNavShow"><a class="active" href="../projectlist.html">Projects</a></li>
                    <li class="jsNavShow"><a class="" href="../bloglist.html">Writing</a></li>
                    <li class="jsNavShow"><a class="" href="../about.html">About</a></li>
                    <li class="jsNavShow"><a href="https://x.com/DystoLabz" target="_blank"><i class="fa fa-twitter"></i></a></li>
                    <li class="jsNavShow"><a id="dark-mode-toggle" href="javascript:void(0)" onclick="toggleDarkMode()" style="cursor: pointer;"><i class="fa fa-moon-o"></i></a></li>
                </ul>
            </nav>
        </div>
    </div>
</header>

<div class="container" style="margin-top: 30px;">
    <div class="row">
        <div class="col-md-11 col-xs-12">
            <!-- Breadcrumb navigation with box -->
            <div class="breadcrumb-box">
                <a href="cryptophunks.html" class="breadcrumb-link">CryptoPhunksV67</a>
                <span class="breadcrumb-separator"> / </span>
                <span class="breadcrumb-current">All QuantumPhunks</span>
            </div>
            <!-- Title -->
            <h1 class="main-title">All QuantumPhunks</h1>
            
            <!-- Navigation buttons with dropdowns -->
            <div style="margin-bottom: 20px;">
                <div style="position: relative; display: inline-block; margin-right: 20px;">
                    <span id="phunk-types-btn" style="color: #333; padding: 4px 8px; font-family: 'Montserrat', sans-serif; font-size: 14px; cursor: pointer; background: none; border: none;">Phunk Types ▼</span>
                    <div id="phunk-types-dropdown" style="display: none; position: absolute; top: 100%; left: 0; background: white; border: 1px solid #ccc; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 15px; min-width: 250px; max-height: 400px; overflow-y: auto; z-index: 1000; font-family: 'Montserrat', sans-serif; font-size: 12px;">
                        <div style="margin-bottom: 10px;">
                            <input type="text" id="phunk-types-search" placeholder="Filter phunk types..." style="width: 100%; padding: 5px; border: 1px solid #ddd; font-size: 12px;">
                        </div>
                        <div id="phunk-types-list"></div>
                        <div style="margin-top: 10px; text-align: center;">
                            <button onclick="clearPhunkTypeFilters()" style="padding: 5px 10px; background: #f0f0f0; border: 1px solid #ccc; cursor: pointer; font-size: 11px;">Clear All</button>
                        </div>
                    </div>
                </div>
                
                <div style="position: relative; display: inline-block; margin-right: 20px;">
                    <span id="attributes-btn" style="color: #333; padding: 4px 8px; font-family: 'Montserrat', sans-serif; font-size: 14px; cursor: pointer; background: none; border: none;">Attributes ▼</span>
                    <div id="attributes-dropdown" style="display: none; position: absolute; top: 100%; left: 0; background: white; border: 1px solid #ccc; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 15px; min-width: 250px; max-height: 400px; overflow-y: auto; z-index: 1000; font-family: 'Montserrat', sans-serif; font-size: 12px;">
                        <div style="margin-bottom: 10px;">
                            <input type="text" id="attributes-search" placeholder="Filter attributes..." style="width: 100%; padding: 5px; border: 1px solid #ddd; font-size: 12px;">
                        </div>
                        <div id="attributes-list"></div>
                        <div style="margin-top: 10px; text-align: center;">
                            <button onclick="clearAttributeFilters()" style="padding: 5px 10px; background: #f0f0f0; border: 1px solid #ccc; cursor: pointer; font-size: 11px;">Clear All</button>
                        </div>
                    </div>
                </div>
                
                <div style="position: relative; display: inline-block;">
                    <span id="attribute-counts-btn" style="color: #333; padding: 4px 8px; font-family: 'Montserrat', sans-serif; font-size: 14px; cursor: pointer; background: none; border: none;">Attribute Counts ▼</span>
                    <div id="attribute-counts-dropdown" style="display: none; position: absolute; top: 100%; left: 0; background: white; border: 1px solid #ccc; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 15px; min-width: 300px; max-height: 400px; overflow-y: auto; z-index: 1000; font-family: 'Montserrat', sans-serif; font-size: 12px;">
                        <div style="margin-bottom: 10px;">
                            <input type="text" id="attribute-counts-search" placeholder="Filter by attribute count..." style="width: 100%; padding: 5px; border: 1px solid #ddd; font-size: 12px;">
                        </div>
                        <div id="attribute-counts-list"></div>
                        <div style="margin-top: 10px; text-align: center;">
                            <button onclick="clearAttributeCountFilters()" style="padding: 5px 10px; background: #f0f0f0; border: 1px solid #ccc; cursor: pointer; font-size: 11px;">Clear All</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Grid Container -->
<div class="container-fluid" style="padding: 0 20px;">
    <div class="row">
        <div class="col-md-12">
            <div id="punks-grid" style="display: grid; grid-template-columns: repeat(12, 90px); margin: 0 auto; padding: 0; gap: 0; justify-content: center;">
                <!-- Punks will be loaded here -->
            </div>
            <div id="loading" style="text-align: center; padding: 40px; font-family: 'Montserrat', arial, helvetica, sans-serif;">
                Loading QuantumPhunks...
            </div>
        </div>
    </div>
</div>

<footer class="main_footer" style="margin-top: 50px;">
    <div class="container">
        <div class="col-md-6 col-sm-6 col-xs-12 pull-right">
            <ul class="list footer_nav_list">
                <li class="jsNavShow"><a class="active" href="../projectlist.html">Projects</a></li>
                <li class="jsNavShow"><a class="" href="../bloglist.html">Writing</a></li>
                <li class="jsNavShow"><a class="" href="../about.html">About</a></li>
                <li class="jsNavShow"><a href="https://x.com/DystoLabz" target="_blank"><i class="fa fa-twitter"></i></a></li>
            </ul>
        </div>
    </div>
</footer>

<style>
    /* Breadcrumb box styling - extended, no border, matches attributes page */
    .breadcrumb-box {
        display: block;
        width: 100%;
        background-color: #f5f5f5;
        border: none;
        padding: 8px 15px;
        font-family: 'Montserrat', arial, helvetica, sans-serif;
        font-size: 16px;
        margin-bottom: 10px;
    }
    .breadcrumb-link {
        color: #B3BF44;
        text-decoration: none;
        font-weight: 700;
    }
    .breadcrumb-link:hover {
        text-decoration: underline;
    }
    .breadcrumb-separator {
        color: #666;
    }
    .breadcrumb-current {
        color: #333;
    }
    /* Main title - matches attributes page styling */
    .main-title {
        font-family: 'Montserrat', arial, helvetica, sans-serif;
        font-size: 45px;
        font-weight: 700;
        color: #333;
        margin-top: 25px;
        margin-bottom: 30px;
    }

    .punk-item {
        width: 90px;
        height: 104px;
        margin: 0;
        padding: 0;
        background-color: white;
        cursor: pointer;
        position: relative;
        text-align: center;
        border: none;
        box-sizing: border-box;
        display: block;
    }
    
    .punk-item img {
        width: 90px;
        height: auto;
        aspect-ratio: 1 / 1;
        image-rendering: pixelated;
        display: block;
        margin: 0;
        padding: 0;
        background-color: #c3ff00;
    }

    /* Ensure EthsRock images in grid use correct aspect ratio and size */
    .punk-item img.ethsrock-img {
        width: 90px !important;
        height: 104px !important;
        aspect-ratio: 350 / 495 !important;
        object-fit: contain !important;
        background-color: #c3ff00;
        display: block;
        margin: 0;
        padding: 0;
    }
    
    .punk-item:hover {
        opacity: 0.8;
        transform: scale(1.05);
        z-index: 10;
    }
    
    .punk-number {
        font-family: 'Montserrat', arial, helvetica, sans-serif;
        font-size: 12px;
        font-weight: 700;
        color: #000;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        text-align: center;
        background-color: white;
        line-height: 12px;
        padding: 1px 0;
    }
    
    /* Remove any spacing */
    #punks-grid {
        display: grid;
        grid-template-columns: repeat(12, 90px);
        gap: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        grid-gap: 0 !important;
        border-spacing: 0 !important;
        justify-content: flex-start;
        overflow-x: auto;
        width: 100%;
        min-width: 1080px;
        /* Prevent squishing by keeping grid fixed and enabling scroll */
        box-sizing: border-box;
        /* Remove any responsive overrides that shrink items */
    }
    
    #punks-grid * {
        margin: 0 !important;
        border: 0 !important;
    }
    
    /* Make rows flow properly */
    #punks-grid {
        line-height: 0;
    }

    /* Mobile: responsive grid that fits screen width */
    @media (max-width: 768px) {
        #punks-grid {
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)) !important;
            min-width: 0 !important;
            overflow-x: hidden !important;
        }
        .punk-item {
            width: 100% !important;
            height: auto !important;
        }
        .punk-item img {
            width: 100% !important;
            height: auto !important;
        }
        .punk-number {
            font-size: 9px !important;
            line-height: 10px !important;
        }
        .main-title {
            font-size: 28px !important;
        }
    }
</style>

<style>
    body.dark-mode {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
    }

    body.dark-mode .main_footer {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
    }

    body.dark-mode .main_header {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
    }

    body.dark-mode a {
        color: #B3BF44 !important;
    }

    body.dark-mode h1, body.dark-mode h2, body.dark-mode h3, body.dark-mode h4, body.dark-mode h5, body.dark-mode h6 {
        color: #ffffff !important;
    }

    body.dark-mode .main-title {
        color: #ffffff !important;
    }

    body.dark-mode .breadcrumb-box {
        background-color: #2a2a2a !important;
        color: #ffffff !important;
    }

    body.dark-mode .breadcrumb-current {
        color: #ffffff !important;
    }

    body.dark-mode .breadcrumb-separator {
        color: #999 !important;
    }

    body.dark-mode .breadcrumb-current {
        color: #ffffff !important;
    }

    body.dark-mode #phunk-types-btn, body.dark-mode #attributes-btn, body.dark-mode #attribute-counts-btn {
        color: #ffffff !important;
    }

    body.dark-mode .phunk-name {
        color: #ffffff !important;
    }

    body.dark-mode p, body.dark-mode .small {
        color: #ffffff !important;
    }

    body.dark-mode .punk-item {
        background-color: #2a2a2a !important;
    }

    body.dark-mode .punk-number {
        background-color: #2a2a2a !important;
        color: #ffffff !important;
    }

    body.dark-mode .phunk-box {
        background-color: #2a2a2a !important;
    }

    body.dark-mode #phunk-types-dropdown,
    body.dark-mode #attributes-dropdown,
    body.dark-mode #attribute-counts-dropdown {
        background-color: #2a2a2a !important;
        border: 1px solid #444 !important;
        color: #ffffff !important;
    }

    body.dark-mode #phunk-types-dropdown input,
    body.dark-mode #attributes-dropdown input,
    body.dark-mode #attribute-counts-dropdown input {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
        border: 1px solid #444 !important;
    }

    body.dark-mode #phunk-types-dropdown label,
    body.dark-mode #attributes-dropdown label,
    body.dark-mode #attribute-counts-dropdown label {
        color: #ffffff !important;
    }

    body.dark-mode #phunk-types-dropdown button,
    body.dark-mode #attributes-dropdown button,
    body.dark-mode #attribute-counts-dropdown button {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
        border: 1px solid #444 !important;
    }

    body.dark-mode [style*="background: white"] {
        background-color: #2a2a2a !important;
        color: #ffffff !important;
    }

    body.dark-mode [style*="background: #f0f0f0"] {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
    }

    body.dark-mode [style*="color: #333"] {
        color: #ffffff !important;
    }

    body.dark-mode [style*="color: #666"] {
        color: #cccccc !important;
    }
</style>

<script>
    console.log('Loading all QuantumPhunks from JSON...');
    
    // Load all punks from JSON
    fetch('../cryptophunks-v67-merged%20(1)%20(1).json?v=' + Date.now())
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('JSON loaded successfully');
            loadAllPunks(data);
        })
        .catch(error => {
            console.error('JSON error, trying alternative path:', error);
            // Try without URL encoding
            fetch('../cryptophunks-v67-merged (1) (1).json?v=' + Date.now())
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Alternative fetch failed! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Alternative fetch successful');
                    loadAllPunks(data);
                })
                .catch(altError => {
                    console.error('Both fetches failed:', altError);
                    document.getElementById('loading').innerHTML = `
                        <div style="color: red; font-family: 'Montserrat', sans-serif;">
                            Error loading QuantumPhunks. Check console for details.
                        </div>`;
                });
        });
    
    function loadAllPunks(data) {
        const items = data.collection_items || [];
        const grid = document.getElementById('punks-grid');
        const loading = document.getElementById('loading');
        
        console.log(`Loading ${items.length} QuantumPhunks...`);
        
        // Clear existing items first to prevent duplicates
        grid.innerHTML = '';
        
        // Sort items by index
        const sortedItems = items.sort((a, b) => parseInt(a.index) - parseInt(b.index));
        
        // Create all punk items
        sortedItems.forEach(item => {
            const punkDiv = document.createElement('div');
            punkDiv.className = 'punk-item';

            const img = document.createElement('img');
            const specialGifIds = [5865, 6850, 8913];

                // Check if this is an EthsRock
                let isEthsRock = false;
                if (item.attributes) {
                    isEthsRock = item.attributes.some(attr => attr.trait_type === 'Type' && attr.value === 'EthsRock');
                }

                if ([5865, 6850, 8913, 6922, 6996].includes(Number(item.index))) {
                    img.src = `../images/images_24x24/${item.index}.gif`;
                } else {
                    img.src = `../images/images_24x24/${item.index}.png`;
                }
                img.alt = `QuantumPhunk ${item.index}`;
                img.style.imageRendering = 'pixelated';

                // Apply EthsRock class for correct aspect ratio
                if (isEthsRock) {
                    img.classList.add('ethsrock-img');
                }

            img.onerror = () => {
                console.warn(`Image ${item.index} not found`);
                img.src = '../images/placeholder.png'; // Fallback if needed
            };

            const numberDiv = document.createElement('div');
            numberDiv.className = 'punk-number';
            numberDiv.textContent = `#${item.index}`;

            punkDiv.appendChild(img);
            punkDiv.appendChild(numberDiv);

            punkDiv.onclick = () => {
                window.location.href = `cryptophunks-details.html?id=${item.index}`;
            };
            
            grid.appendChild(punkDiv);
        });
        
        // Hide loading
        loading.style.display = 'none';
        console.log('All QuantumPhunks loaded successfully!');
        
        // Setup dropdown functionality
        setupDropdowns(items);
    }
    
    // Global variables for filtering
    let allPunksData = [];
    let selectedPhunkTypes = new Set();
    let selectedAttributes = new Set();
    let selectedAttributeCounts = new Set();
    let currentSearchTerm = '';

    function setupDropdowns(items) {
        allPunksData = items;
        
        // Extract data for dropdowns
        const phunkTypes = new Set();
        const attributesByType = {};
        const attributeCounts = {};
        
        items.forEach(item => {
            if (item.attributes) {
                // Count attributes excluding Type, Animal, Species
                const excludedTraits = ['Type', 'Animal', 'Species'];
                const countableAttributes = item.attributes.filter(attr => 
                    !excludedTraits.includes(attr.trait_type)
                );
                const totalAttributes = countableAttributes.length;
                const countKey = `${totalAttributes} attribute${totalAttributes === 1 ? '' : 's'}`;
                attributeCounts[countKey] = (attributeCounts[countKey] || 0) + 1;

                item.attributes.forEach(attr => {
                    // Add to phunk types if it's a Type attribute
                    if (attr.trait_type === 'Type') {
                        phunkTypes.add(attr.value);
                    }

                    // Group attributes by type
                    if (!attributesByType[attr.trait_type]) {
                        attributesByType[attr.trait_type] = new Set();
                    }
                    attributesByType[attr.trait_type].add(attr.value);
                });
            }
        });
        
        // Setup Phunk Types dropdown
        setupPhunkTypesDropdown(Array.from(phunkTypes).sort());
        
        // Setup Attributes dropdown  
        setupAttributesDropdown(attributesByType);
        
        // Setup Attribute Counts dropdown
        setupAttributeCountsDropdown(attributeCounts);
        
        // Setup click handlers
        document.getElementById('phunk-types-btn').onclick = () => {
            toggleDropdown('phunk-types-dropdown');
        };
        
        document.getElementById('attributes-btn').onclick = () => {
            toggleDropdown('attributes-dropdown');
        };
        
        document.getElementById('attribute-counts-btn').onclick = () => {
            toggleDropdown('attribute-counts-dropdown');
        };
        
        // Setup main search functionality
        const searchBox = document.getElementById('search-box');
        searchBox.addEventListener('input', (e) => {
            currentSearchTerm = e.target.value.toLowerCase();
            applyAllFilters();
        });
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('[id$="-btn"]') && !e.target.closest('[id$="-dropdown"]')) {
                ['phunk-types-dropdown', 'attributes-dropdown', 'attribute-counts-dropdown']
                    .forEach(id => document.getElementById(id).style.display = 'none');
            }
        });
    }
    
    function setupPhunkTypesDropdown(phunkTypes) {
        const searchInput = document.getElementById('phunk-types-search');
        const listContainer = document.getElementById('phunk-types-list');
        
        function renderPhunkTypes(filteredTypes = phunkTypes) {
            listContainer.innerHTML = filteredTypes.map(type => `
                <div style="margin-bottom: 8px;">
                    <label style="display: flex; align-items: center; cursor: pointer; padding: 4px 0;">
                        <input type="checkbox" value="${type}" onchange="togglePhunkTypeFilter('${type}')" 
                               ${selectedPhunkTypes.has(type) ? 'checked' : ''}
                               style="margin-right: 8px;">
                        <span style="color: #666; font-family: 'Montserrat', arial, helvetica, sans-serif;">${type}</span>
                    </label>
                </div>
            `).join('');
        }
        
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filtered = phunkTypes.filter(type => 
                type.toLowerCase().includes(searchTerm)
            );
            renderPhunkTypes(filtered);
        });
        
        renderPhunkTypes();
    }
    
    function setupAttributesDropdown(attributesByType) {
        const searchInput = document.getElementById('attributes-search');
        const listContainer = document.getElementById('attributes-list');
        
        function renderAttributes(searchTerm = '') {
            const html = Object.keys(attributesByType).sort().map(traitType => {
                const values = Array.from(attributesByType[traitType]).sort();
                const filteredValues = searchTerm ? 
                    values.filter(value => 
                        value.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        traitType.toLowerCase().includes(searchTerm.toLowerCase())
                    ) : values;
                    
                if (filteredValues.length === 0) return '';
                
                return `
                    <div style="margin-bottom: 12px;">
                        <div style="font-weight: bold; padding: 4px 0; color: #333; border-bottom: 1px solid #eee; font-family: 'Montserrat', arial, helvetica, sans-serif;">${traitType}</div>
                        ${filteredValues.map(value => {
                            const attrKey = `${traitType}:${value}`;
                            return `
                                <div style="margin-left: 15px; margin-bottom: 4px;">
                                    <label style="display: flex; align-items: center; cursor: pointer; padding: 2px 0;">
                                        <input type="checkbox" value="${attrKey}" onchange="toggleAttributeFilter('${attrKey}')"
                                               ${selectedAttributes.has(attrKey) ? 'checked' : ''}
                                               style="margin-right: 8px;">
                                        <span style="color: #666; font-size: 11px; font-family: 'Montserrat', arial, helvetica, sans-serif;">${value}</span>
                                    </label>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }).join('');
            
            listContainer.innerHTML = html;
        }
        
        searchInput.addEventListener('input', (e) => {
            renderAttributes(e.target.value);
        });
        
        renderAttributes();
    }
    
    function setupAttributeCountsDropdown(attributeCounts) {
        const searchInput = document.getElementById('attribute-counts-search');
        const listContainer = document.getElementById('attribute-counts-list');
        
        function renderAttributeCounts(searchTerm = '') {
            // Sort by attribute count (descending)
            const sorted = Object.entries(attributeCounts)
                .map(([countStr, numPunks]) => {
                    // Extract number from "X attributes" string
                    const count = parseInt(countStr.split(' ')[0]);
                    return [count, countStr, numPunks];
                })
                .sort((a, b) => b[0] - a[0]); // Sort by count descending
                
            const filtered = searchTerm ? 
                sorted.filter(([count, countStr, numPunks]) => 
                    countStr.toLowerCase().includes(searchTerm.toLowerCase())
                ) : sorted;
            
            listContainer.innerHTML = filtered.map(([count, countStr, numPunks]) => `
                <div style="margin-bottom: 8px;">
                    <label style="display: flex; align-items: center; justify-content: space-between; cursor: pointer; padding: 4px 0;">
                        <div style="display: flex; align-items: center;">
                            <input type="checkbox" value="${count}" onchange="toggleAttributeCountFilter(${count})" 
                                   ${selectedAttributeCounts.has(count) ? 'checked' : ''}
                                   style="margin-right: 8px;">
                            <span style="color: #666; font-size: 12px; font-family: 'Montserrat', arial, helvetica, sans-serif;">${countStr}</span>
                        </div>
                        <span style="color: #333; font-weight: bold; font-family: 'Montserrat', arial, helvetica, sans-serif;">(${numPunks})</span>
                    </label>
                </div>
            `).join('');
        }
        
        searchInput.addEventListener('input', (e) => {
            renderAttributeCounts(e.target.value);
        });
        
        renderAttributeCounts();
    }
    
    function togglePhunkTypeFilter(type) {
        if (selectedPhunkTypes.has(type)) {
            selectedPhunkTypes.delete(type);
        } else {
            selectedPhunkTypes.add(type);
        }
        applyAllFilters();
    }
    
    function toggleAttributeFilter(attrKey) {
        if (selectedAttributes.has(attrKey)) {
            selectedAttributes.delete(attrKey);
        } else {
            selectedAttributes.add(attrKey);
        }
        applyAllFilters();
    }
    
    function toggleAttributeCountFilter(count) {
        if (selectedAttributeCounts.has(count)) {
            selectedAttributeCounts.delete(count);
        } else {
            selectedAttributeCounts.add(count);
        }
        applyAllFilters();
    }
    
    function clearPhunkTypeFilters() {
        selectedPhunkTypes.clear();
        // Uncheck all checkboxes
        const checkboxes = document.querySelectorAll('#phunk-types-list input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = false);
        applyAllFilters();
    }
    
    function clearAttributeFilters() {
        selectedAttributes.clear();
        // Uncheck all checkboxes
        const checkboxes = document.querySelectorAll('#attributes-list input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = false);
        applyAllFilters();
    }
    
    function clearAttributeCountFilters() {
        selectedAttributeCounts.clear();
        // Uncheck all checkboxes
        const checkboxes = document.querySelectorAll('#attribute-counts-list input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = false);
        applyAllFilters();
    }
    
    function toggleDropdown(dropdownId) {
        const dropdown = document.getElementById(dropdownId);
        const isVisible = dropdown.style.display !== 'none';
        
        // Hide all dropdowns first
        ['phunk-types-dropdown', 'attributes-dropdown', 'attribute-counts-dropdown']
            .forEach(id => document.getElementById(id).style.display = 'none');
        
        if (!isVisible) {
            dropdown.style.display = 'block';
        }
    }
    
    function applyAllFilters() {
        const grid = document.getElementById('punks-grid');
        const totalCount = document.getElementById('total-count');
        let visibleCount = 0;
        
        Array.from(grid.children).forEach(punkDiv => {
            const punkNumber = punkDiv.querySelector('.punk-number').textContent;
            const punkIndex = punkNumber.replace('#', '');
            
            // Find the punk data
            const punkData = allPunksData.find(item => item.index.toString() === punkIndex);
            
            let shouldShow = true;
            
            // Apply search filter
            if (currentSearchTerm !== '') {
                let matchesSearch = false;
                
                // Search in punk number
                if (punkIndex.includes(currentSearchTerm)) {
                    matchesSearch = true;
                }
                
                // Search in attributes
                if (punkData && punkData.attributes) {
                    const hasMatchingAttribute = punkData.attributes.some(attr => 
                        attr.trait_type.toLowerCase().includes(currentSearchTerm) ||
                        attr.value.toLowerCase().includes(currentSearchTerm)
                    );
                    if (hasMatchingAttribute) {
                        matchesSearch = true;
                    }
                }
                
                if (!matchesSearch) shouldShow = false;
            }
            
            // Apply phunk type filter
            if (shouldShow && selectedPhunkTypes.size > 0) {
                if (punkData && punkData.attributes) {
                    const typeAttr = punkData.attributes.find(attr => attr.trait_type === 'Type');
                    if (!typeAttr || !selectedPhunkTypes.has(typeAttr.value)) {
                        shouldShow = false;
                    }
                } else {
                    shouldShow = false;
                }
            }
            
            // Apply attribute filter
            if (shouldShow && selectedAttributes.size > 0) {
                if (punkData && punkData.attributes) {
                    const hasSelectedAttribute = punkData.attributes.some(attr => {
                        const attrKey = `${attr.trait_type}:${attr.value}`;
                        return selectedAttributes.has(attrKey);
                    });
                    if (!hasSelectedAttribute) {
                        shouldShow = false;
                    }
                } else {
                    shouldShow = false;
                }
            }
            
            // Apply attribute count filter
            if (shouldShow && selectedAttributeCounts.size > 0) {
                if (punkData && punkData.attributes) {
                    // Count attributes excluding Type and Species
                    const countableAttributes = punkData.attributes.filter(attr => 
                        attr.trait_type !== 'Type' && attr.trait_type !== 'Species'
                    );
                    const punkAttributeCount = countableAttributes.length;
                    if (!selectedAttributeCounts.has(punkAttributeCount)) {
                        shouldShow = false;
                    }
                } else {
                    shouldShow = false;
                }
            }
            
            punkDiv.style.display = shouldShow ? 'block' : 'none';
            if (shouldShow) visibleCount++;
        });
        
        // Update count with comma formatting
        totalCount.textContent = visibleCount.toLocaleString();
    }

    // Dark Mode Toggle
    function toggleDarkMode() {
        const body = document.body;
        const isDarkMode = body.classList.contains('dark-mode');
        const toggle = document.getElementById('dark-mode-toggle');
        if (isDarkMode) {
            body.classList.remove('dark-mode');
            localStorage.setItem('darkMode', 'false');
            toggle.innerHTML = '<i class="fa fa-moon-o"></i>';
        } else {
            body.classList.add('dark-mode');
            localStorage.setItem('darkMode', 'true');
            toggle.innerHTML = '<i class="fa fa-sun-o"></i>';
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const toggle = document.getElementById('dark-mode-toggle');
        const darkModeEnabled = localStorage.getItem('darkMode') === 'true';
        if (darkModeEnabled) {
            document.body.classList.add('dark-mode');
            toggle.innerHTML = '<i class="fa fa-sun-o"></i>';
        }
    });
</script>

<svg hidden>
    <defs>
        <g id="icon-logo">
            <path d="M0,3.5 C0,1.56700338 1.57093664,0 3.5,0 C5.43299662,0 7,1.57093664 7,3.5 C7,5.43299662 5.42906336,7 3.5,7 C1.56700338,7 0,5.42906336 0,3.5 Z M0,13.5 C0,11.5670034 1.57093664,10 3.5,10 C5.43299662,10 7,11.5709366 7,13.5 C7,15.4329966 5.42906336,17 3.5,17 C1.56700338,17 0,15.4290634 0,13.5 Z M0,22.5 C0,20.5670034 1.57093664,19 3.5,19 C5.43299662,19 7,20.5709366 7,22.5 C7,24.4329966 5.42906336,26 3.5,26 C1.56700338,26 0,24.4290634 0,22.5 Z M12,4 C12,2.8954305 12.8877296,2 14,2 C15.1045695,2 16,2.88772964 16,4 C16,5.1045695 15.1122704,6 14,6 C12.8954305,6 12,5.11227036 12,4 Z M12,14 C12,12.8954305 12.8877296,12 14,12 C15.1045695,12 16,12.8877296 16,14 C16,15.1045695 15.1122704,16 14,16 C12.8954305,16 12,15.1122704 12,14 Z M12,23 C12,21.8954305 12.8877296,21 14,21 C15.1045695,21 16,21.8877296 16,23 C16,24.1045695 15.1122704,25 14,25 C12.8954305,25 12,24.1122704 12,23 Z" id="logo"></path>
        </g>
    </defs>
</svg>

<script src="../public/javascripts/script.js"></script>

</body>
</html>